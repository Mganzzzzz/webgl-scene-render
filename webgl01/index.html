<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <link rel="icon" type="image/svg+xml" href="favicon.svg"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Vite App</title>
    <style>
        body {
            background-color: #504444;
        }

        canvas {
            border: 1px solid lightblue;
        }
    </style>
</head>
<script type="x-shader/x-vertex" id="test.vs">
    // an attribute will receive data from a buffer
    precision mediump float;

    attribute vec4 position;
    attribute vec4 color;
    attribute vec2 texcoord;
    uniform mat4 M;
    uniform mat4 P;
    uniform mat4 V;
    varying vec4 V_Color;
    varying vec2 V_texcord;

    void main() {
        V_Color=color;
        V_texcord = texcoord;
        gl_Position=P*V*M*position;
    }

</script>
<script type="x-shader/x-fragment" id="test.fs">
    // fragment shaders don't have a default precision so we need
    // to pick one. mediump is a good default
    precision mediump float;
    varying vec4 V_Color;
    varying vec2 V_texcord;
    uniform sampler2D U_texture;
    void main() {
        // gl_FragColor is a special variable a fragment shader
        // is responsible for setting
        gl_FragColor = V_Color * texture2D(U_texture, V_texcord);;// return redish-purple
    }
</script>
<script type="x-shader/x-vertex" id="ground.vs">
    // an attribute will receive data from a buffer
    precision mediump float;

    attribute vec4 position;
    attribute vec4 color;
    attribute vec2 texcoord;
    uniform mat4 M;
    uniform mat4 P;
    uniform mat4 V;
    varying vec4 V_Color;
    varying vec2 V_texcord;

    void main() {
        V_Color=color;
        V_texcord = texcoord;
        gl_Position=P*V*M*position;
    }

</script>
<script type="x-shader/x-fragment" id="ground.fs">
    // fragment shaders don't have a default precision so we need
    // to pick one. mediump is a good default
    precision mediump float;
    varying vec4 V_Color;
    varying vec2 V_texcord;
    uniform sampler2D U_texture;
    void main() {
        // gl_FragColor is a special variable a fragment shader
        // is responsible for setting
        gl_FragColor = texture2D(U_texture, V_texcord);;// return redish-purple
    }
</script>

<script type="x-shader/x-vertex" id="light.vs">
    precision mediump float;

    attribute vec4 position;
    attribute vec4 color;
    attribute vec2 texcoord;
    attribute vec4 normal;
    uniform mat4 M;
    uniform mat4 P;
    uniform mat4 V;
    // 环境光
    uniform vec4 U_AmbientMaterial;
    uniform vec4 U_AmbientLight;
    // 漫反射
    uniform vec4 U_DiffuseMaterial;
    uniform vec4 U_DiffuseLight;

    // 法线矩阵
    uniform vec4 IT_ModelMatrix;
    //光源位置
    uniform vec4 U_LightPos;

    varying vec4 V_Color;

    void main() {
        vec3 L= U_LightPos.xyz;
        L=normalize(L);// 求出物体表面射向光源的向量
        vec3 n=normalize((normal).xyz);//求法线 方便计算光照强度
        float diffuseIntensity=max(0.0, dot(L, n));//有时光照强度计算为负 所以用 max 和0 对比
        vec4 diffuseColor=U_DiffuseLight*U_DiffuseMaterial*diffuseIntensity;// 漫反射颜色
        V_Color=U_AmbientMaterial*U_AmbientLight+diffuseColor;
        gl_Position=P*V*M*position;
    }

</script>
<script type="x-shader/x-fragment" id="light.fs">
    // fragment shaders don't have a default precision so we need
    // to pick one. mediump is a good default
    precision mediump float;
    //    varying vec4 V_Color;
    varying vec4 V_Color;
    void main() {
        gl_FragColor= V_Color;
    }
</script>
<script type="x-shader/x-vertex" id="light_color.vs">
    precision mediump float;

    attribute vec4 position;
    attribute vec4 color;
    attribute vec4 texcoord;
    attribute vec4 normal;
    uniform mat4 M;
    uniform mat4 P;
    uniform mat4 V;
    // 环境光
    uniform vec4 U_AmbientMaterial;
    uniform vec4 U_AmbientLight;
    // 漫反射
    uniform vec4 U_DiffuseMaterial;
    uniform vec4 U_DiffuseLight;

    // 法线矩阵
    uniform vec4 IT_ModelMatrix;
    //光源位置
    uniform vec4 U_LightPos;

    varying vec4 V_texcord;
    varying vec4 V_Color;

    void main() {
        vec3 L= U_LightPos.xyz;
        V_texcord = texcoord;
        L=normalize(L);// 求出物体表面射向光源的向量
        vec3 n=normalize((normal).xyz);//求法线 方便计算光照强度
        float diffuseIntensity=max(0.0, dot(L, n));//有时光照强度计算为负 所以用 max 和0 对比
        vec4 diffuseColor=U_DiffuseLight*U_DiffuseMaterial*diffuseIntensity;// 漫反射颜色
        V_Color=(U_AmbientMaterial*U_AmbientLight+diffuseColor) * color;
        gl_Position=P*V*M*position;
    }

</script>
<script type="x-shader/x-fragment" id="light_color.fs">
    // fragment shaders don't have a default precision so we need
    // to pick one. mediump is a good default
    precision mediump float;
    varying vec4 V_texcord;
    uniform sampler2D U_texture;
    varying vec4 V_Color;
    void main() {
        gl_FragColor= texture2D(U_texture, V_texcord.xy);
    }
</script>


<body>
<!--<div id="app"></div>-->
<script src="webgl-utils.js"></script>
<script src="m4.js"></script>
<canvas id="c" width="800" height="600"></canvas>
<script>
    window.canvas = document.querySelector("#c");
    window.gl = canvas.getContext("webgl");
</script>

<script type="module" src="/src/main.js"></script>
</body>
</html>
